<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>jQuery UI Dialog - Default functionality</title>
	
    <script type="text/javascript" src="../jquery/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="../jquery/jquery-ui-1.8.20.custom.min.js"></script>
   		<script type="text/javascript" src="../jquery/lib/jquery/plugins/tooltip/js/jquery.ui.tooltip.js"></script>
        <script type="text/javascript" src="../jquery/framework/core/js/FluidDocument.js"></script>
        <script type="text/javascript" src="../jquery/framework/core/js/Fluid.js"></script>
        <script type="text/javascript" src="../jquery/framework/core/js/DataBinding.js"></script>
        <script type="text/javascript" src="../jquery/components/tooltip/js/Tooltip.js"></script>
        <link rel="stylesheet" type="text/css" href="../jquery/lib/jquery/plugins/tooltip/css/jquery.tooltip.css" />
    
    <link rel='stylesheet' type='text/css' href='../jquery/jquery-ui-1.8.20.custom.css' />

    <link rel='stylesheet' type='text/css' href='../fullcalendar/fullcalendar.css' />
    <link rel='stylesheet' type='text/css' href='../fullcalendar/fullcalendar.print.css' media='print' />
    <script type='text/javascript' src='../fullcalendar/fullcalendar.js'></script>
       
	<script>
	    $(document).ready(function () {
	        var date = new Date();
	        var d = date.getDate();
	        var m = date.getMonth();
	        var y = date.getFullYear();
            
	        var calendar = $('#calendar').fullCalendar({
	            header: {
	                left: 'prev,next today',
	                center: 'title',
	                right: 'month,agendaWeek,agendaDay'
	            },
	            selectable: true,
	            selectHelper: true,
				/*eventAfterRender: function( evento,elemento,viewo ){
					console.log( evento.title + "  " +elemento.html());
				},*/
				viewDisplay: function(view) {
        			//console.log('The new title of the view is ' + view.title+" "+$(this).html());
					if( view.name == "month" )
					{
						for( var ty=0; ty<= 41;ty++)
						{
							//console.log($(this).find(".fc-day"+ty).html());
							fluid.tooltip(".fc-day"+ty, {
								content: function () {
									//return $(this).parent().text();
									//console.log($(this).html());
									if ( $(this).html().indexOf( "fc-day-content" ) >= 0 )
										return $(this).prev().prev().text();
									else if ( $(this).html().indexOf("div") >= 0)
										return $(this).parent().prev().prev().text();
									else
										return $(this).parent().parent().prev().prev().text();
									return "";								
								}
							});
						}
					}
    			},
				//event is clicked
				eventClick: function(calevent,jsEvent,view){
					//console.log("event clicked");
					$("#fc-emode1").val("edit");
					
					$("#dialog1").dialog('open');
	                $("#name1").val(calevent.title);
										
					var date = calevent.start;
					
	                $("#date-start1").val($.fullCalendar.formatDate(date, 'MM/dd/yyyy'));
	                //$("#date-start").datepicker("setDate", date);
                    //$("#date-start").val($.fullCalendar.formatDate(date, 'MM/dd/yyyy'));
					//alert( view.name );
                    if( view.name == "month" )
	                {
						//alert("month");
						$("#container-fc-tm").html("<input type='text' name='time' id='time-start1' disabled='disabled' class='text ui-widget-content ui-corner-all'>");
						document.getElementById("date-end1").disabled = false;
						document.getElementById("date-start1").disabled = false;
						$("#time-start1").addClass("hidden2");
						$("#time-end1").addClass("hidden2");   
						$("#date-start1").datepicker();
						$("#date-start1").datepicker("setDate", date);
                        $("#date-end1").datepicker();
						//$("#date-end1").datepicker("option", "minDate", date);
						if( calevent.end != null )
							$("#date-end1").datepicker("setDate", calevent.end);
						else
							$("#date-end1").datepicker("setDate", date);
                    }
                    else
                    {
                        //document.getElementById("date-end1").disabled = true;
						//document.getElementById("date-start1").disabled = true;
						$("#container-fc-tm").html("<select name='time' id='time-start1' class='text ui-widget-content ui-corner-all'></select>");
						$("#time-start1").removeClass("hidden2");
						$("#time-end1").removeClass("hidden2");
						$("#date-end1").val($.fullCalendar.formatDate(date, 'MM/dd/yyyy'));
						//$("#date-end").attr("disabled","true");
						$("#time-start1").val(date.getHours()+":"+date.getMinutes());
						
						select = $('#time-end1');
						$("#time-end1 > option").each(function() {
    						$(this).remove();
						});
						var startpt = date.getHours();
						var endpt = calevent.end;
						var bol = true;
						/*if( date.getMinutes() == 0 )
                        	bol = false;
                    	else
						{
							startpt++;							
                        	bol = true;
						}*/
						for(zz=0;zz<=24;zz++)
						{
							if( zz == 24 )
							{
								select.append("<option value='"+zz+":0' >"+zz+"</option>");
							}
							else
							{
								if( bol )	
                				{
									select.append("<option value='"+zz+":0' >"+zz+"</option>");									
								}
								select.append("<option value='"+zz+":30' >"+zz+":30"+"</option>");								
								bol = true;								
							}
						}
						//console.log(endpt.getHours());
						select.val(endpt.getHours()+":"+endpt.getMinutes());
						
						select = $('#time-start1');
						bol = true;
						
						for(zz=0;zz<=24;zz++)
						{
							if( zz == 24 )
							{
								select.append("<option value='"+zz+":0' >"+zz+"</option>");
							}
							else
							{
								if( bol )	
                				{
									select.append("<option value='"+zz+":0' >"+zz+"</option>");									
								}
								select.append("<option value='"+zz+":30' >"+zz+":30"+"</option>");								
								bol = true;								
							}
						}
						
						select.val(date.getHours()+":"+date.getMinutes());
												            			
                    }
	                $("#viewname1").val(view.name);
				},
				//enter data
	            select: function (date,end, allDay, jsEvent, view) {
					$("#fc-emode").val("create");
					
	                $("#dialog").dialog('open');
	                $("#name").val("[event name]");
					                
					$("#date-start").val($.fullCalendar.formatDate(date, 'MM/dd/yyyy'));
	                //$("#date-start").datepicker("setDate", date);
                    //$("#date-start").val($.fullCalendar.formatDate(date, 'MM/dd/yyyy'));
					//alert( view.name );
                    if( view.name == "month" )
	                {
						//alert("month");
						document.getElementById("date-end").disabled = false;
						$("#time-start").addClass("hidden2");
						$("#time-end").addClass("hidden2");   
                        $("#date-end").datepicker();
						$("#date-end").datepicker("option", "minDate", date);
	                    $("#date-end").datepicker("setDate", date);
                    }
                    else
                    {
                        document.getElementById("date-end").disabled = true;
						$("#time-start").removeClass("hidden2");
						$("#time-end").removeClass("hidden2");
						$("#date-end").val($.fullCalendar.formatDate(date, 'MM/dd/yyyy'));
						//$("#date-end").attr("disabled","true");
						$("#time-start").val(date.getHours()+":"+date.getMinutes());
						
						select = $('#time-end');
						$("#time-end > option").each(function() {
    						$(this).remove();
						});
						var startpt = date.getHours();
						var bol = false;
						if( date.getMinutes() == 0 )
                        	bol = false;
                    	else
						{
							startpt++;							
                        	bol = true;
						}
            			for(zz=startpt;zz<=24;zz++)
            			{
							if( zz == 24 )
							{
								select.append("<option value='"+zz+":0' >"+zz+"</option>");
							}
							else
							{
								if( bol )	
                				{
									select.append("<option value='"+zz+":0' >"+zz+"</option>");
								}
								select.append("<option value='"+zz+":30' >"+zz+":30"+"</option>");
								bol = true;
								
							}
								
            			}
						
                    	if( date.getMinutes() == 0 )
                        	$("#time-end").val(date.getHours()+":30");
                    	else
                        	$("#time-end").val((parseInt(date.getHours())+1)+":0");
                    }

	                $("#viewname").val(view.name);	                
	            },

	            editable: true,
	            events: [
				{
					id: 1,
				    title: 'All Day Event',
				    start: new Date(y, m, 1),
				    end: new Date(y,m,1)
				},
				{
					id: 2,
				    title: 'Long Event',
				    start: new Date(y, m, d - 5),
				    end: new Date(y, m, d - 2)
				},
				{
				    id: 3,
				    title: 'Repeating Event',
				    start: new Date(y, m, d - 3, 16, 0),
				    allDay: false
				},
				{
				    id: 4,
				    title: 'Test Event',
				    start: new Date(y, m, d + 4, 16, 0),
				    allDay: false
				},
				{
					id: 5,
				    title: 'Meeting',
				    start: new Date(y, m, 8, 10, 30),
				    allDay: false,					
				},
				{
					id: 6,
				    title: 'Lunch',
				    start: new Date(y, m+2, 9, 12, 0),
				    end: new Date(y, m, 9, 23, 30),
				    allDay: false,					
				},
				{
					id: 7,
				    title: 'Birthday Party',
				    start: new Date(y, m, d + 1, 3, 0),
				    end: new Date(y, m, d + 1, 4, 0),
				    allDay: false,					
				},
				{
					id: 8,
				    title: 'Click for Google',
				    start: new Date(y, m, 28),
				    end: new Date(y, m, 29),				    
				}
			]
	        });
			//create mode
				$("#dialog").dialog({
					autoOpen: false,
					height: 350,
					width: 700,
					modal: true,
					buttons: {
						'Create event': function () {						
						var startsplt = $("#date-start").val().split("/");
						var ends;
						if( $('#viewname').val() == "month" )
							ends = $.fullCalendar.formatDate($("#date-end").datepicker("getDate"), 'MM/dd/yyyy');
						else
						{
							ends =  $("#date-start").val();
								
							var timestr = $('#time-start').val().split(':');
							var timestp = $('#time-end').val().split(':');						
						}
						var endsplt = ends.split("/");
						
						if( startsplt[1].charAt(0) == '0' )
						{
							startsplt[1] = startsplt[1].charAt(1);
						}
						if( endsplt[1].charAt(0) == '0' )
						{
							endsplt[1] = endsplt[1].charAt(1);
						}
						if( startsplt[0].charAt(0) == '0' )
						{
							startsplt[0] = startsplt[0].charAt(1);
						}
						if( endsplt[0].charAt(0) == '0' )
						{
							endsplt[0] = endsplt[0].charAt(1);
						}
						
						 if( $('#viewname').val() == "month" )
							{
								calendar.fullCalendar('renderEvent',
									{
										title: $("#name").val(),
										start: new Date(parseInt(startsplt[2]),parseInt(startsplt[0])-1,parseInt(startsplt[1])),
										end: new Date(parseInt(endsplt[2]),parseInt(endsplt[0])-1,parseInt(endsplt[1])),				                                       
									},
								true // make the event "stick"
								);
								$(this).dialog('close');
							}
							else
							{
								calendar.fullCalendar('renderEvent',
									{
										title: $("#name").val(),
										start: new Date(parseInt(startsplt[2]),parseInt(startsplt[0])-1,parseInt(startsplt[1]),timestr[0],timestr[1]),
										end: new Date(parseInt(endsplt[2]),parseInt(endsplt[0])-1,parseInt(endsplt[1]),timestp[0],timestp[1]),
										allDay: false,		                                        
									},
								true // make the event "stick"
								);
								$(this).dialog('close');
							}
						},
						Cancel: function () {
							$(this).dialog('close');
						}
					},
					close: function () {
					}
	
				});
			//edit mode
				$("#dialog1").dialog({
					autoOpen: false,
					height: 350,
					width: 700,
					modal: true,
					buttons: {
						'Delete Event': function() {
							calendar.fullCalendar('removeEvents',
							function( ev ){
								$(".fc-hidden").each(
								function(index){
									if( $(this).next().text().indexOf( ev.title ) >= 0 )
									{
										$(this).next().html("");
									}
								});
								$(".hidden1").each(
								function(index){
									if( $(this).next().text().indexOf( ev.title ) >= 0 )
									{
										$(this).next().html("");
									}
								});
								if( ev.title == $("#name1").val())
									return true;
							}
							
						);
						$(this).dialog('close');
						},
						'Edit event': function () {
						
						var startsplt = $("#date-start1").val().split("/");
						var ends;
						if( $('#viewname1').val() == "month" )
							ends = $.fullCalendar.formatDate($("#date-end1").datepicker("getDate"), 'MM/dd/yyyy');
						else
						{
							ends =  $("#date-start1").val();
								
							var timestr = $('#time-start1').val().split(':');
							var timestp = $('#time-end1').val().split(':');						
						}
						var endsplt = ends.split("/");
						
						if( startsplt[1].charAt(0) == '0' )
						{
							startsplt[1] = startsplt[1].charAt(1);
						}
						if( endsplt[1].charAt(0) == '0' )
						{
							endsplt[1] = endsplt[1].charAt(1);
						}
						if( startsplt[0].charAt(0) == '0' )
						{
							startsplt[0] = startsplt[0].charAt(1);
						}
						if( endsplt[0].charAt(0) == '0' )
						{
							endsplt[0] = endsplt[0].charAt(1);
						}
						
						if( $('#viewname1').val() == "month" )
						{
							var sdat = new Date(parseInt(startsplt[2]),parseInt(startsplt[0])-1,parseInt(startsplt[1]));
							var edat = new Date(parseInt(endsplt[2]),parseInt(endsplt[0])-1,parseInt(endsplt[1]));
							if( edat < sdat )
							{
								alert("Enter valid dates");
								$(this).dialog('close');
								return;
							}
						}
						else
						{
							var sdat = new Date(parseInt(startsplt[2]),parseInt(startsplt[0])-1,parseInt(startsplt[1]),timestr[0],timestr[1]);
							var edat = new Date(parseInt(endsplt[2]),parseInt(endsplt[0])-1,parseInt(endsplt[1]),timestp[0],timestp[1]);
							if( edat < sdat )
							{
								alert("Enter valid dates");
								$(this).dialog('close');
								return;
							}
						}
						
						calendar.fullCalendar('removeEvents',
							function( ev ){
								$(".fc-hidden").each(
								function(index){
									if( $(this).next().text().indexOf( ev.title ) >= 0 )
									{
										$(this).next().html("");
									}
								});
								$(".hidden1").each(
								function(index){
									if( $(this).next().text().indexOf( ev.title ) >= 0 )
									{
										$(this).next().html("");
									}
								});
								if( ev.title == $("#name1").val())
									return true;
								
							}
						);
						
						 if( $('#viewname1').val() == "month" )
							{
								calendar.fullCalendar('renderEvent',
									{
										title: $("#name1").val(),
										start: new Date(parseInt(startsplt[2]),parseInt(startsplt[0])-1,parseInt(startsplt[1])),
										end: new Date(parseInt(endsplt[2]),parseInt(endsplt[0])-1,parseInt(endsplt[1])),				                                       
									},
								true // make the event "stick"
								);
								$(this).dialog('close');
							}
							else
							{
								calendar.fullCalendar('renderEvent',
									{
										title: $("#name1").val(),
										start: new Date(parseInt(startsplt[2]),parseInt(startsplt[0])-1,parseInt(startsplt[1]),timestr[0],timestr[1]),
										end: new Date(parseInt(endsplt[2]),parseInt(endsplt[0])-1,parseInt(endsplt[1]),timestp[0],timestp[1]),
										allDay: false,		                                        
									},
								true // make the event "stick"
								);
								$(this).dialog('close');
							}
						},
						Cancel: function () {
							$(this).dialog('close');
						}
					},
					close: function () {
					}
	
				});
			
            /*add new time rows
            select = $('#time-end');
            for(zz=0;zz<=23;zz++)
            {
                select.append("<option value='"+zz+":0' >"+zz+"</option>");
                select.append("<option value='"+zz+":30' >"+zz+":30"+"</option>");
            }*/
			
        });
	</script>
    <style type='text/css'>

	#calendar {
		width: 900px;
		margin: 0 auto;
		}

</style>
</head>

<body>
 <div id="dialog" class="event-dialog" title="Event">
            <div id="dialog-inner">
                <input type="text" name="name" id="name" class="text ui-widget-content ui-corner-all title"><br>
                <span class="inline">From:</span>
                <br />
                <span class="inline"><input type="text" name="date-start" id="date-start" disabled="disabled" class="text ui-widget-content ui-corner-all"></span>
                <span class="inline"><input type="text" name="time" id="time-start" disabled="disabled" class="text ui-widget-content ui-corner-all"></span>
                <br />
                <span class="inline">To:</span>
                <br /> 
                <span class="inline"><input type="text" name="date" id="date-end" class="text ui-widget-content ui-corner-all"></span>
                <span class="inline"><!--<input type="text" name="time" id="time-end" class="text ui-widget-content ui-corner-all">--></span>
                    <select name="time" id="time-end" class="text ui-widget-content ui-corner-all">
                    </select>
                <br />
                <input type="hidden" id="viewname" />
                <input type="hidden"  id="fc-emode" />               
            </div>
        </div>
        <div id="dialog1" class="event-dialog" title="Event">
            <div id="dialog-inner1">
                <input type="text" name="name" id="name1" class="text ui-widget-content ui-corner-all title"><br>
                <span class="inline">From:</span>
                <br />
                <span class="inline"><input type="text" name="date-start" id="date-start1" class="text ui-widget-content ui-corner-all"></span>
                <span class="inline"><span id="container-fc-tm"><input type='text' name='time' id='time-start1' disabled='disabled' class='text ui-widget-content ui-corner-all'></span></span>
                <br />
                <span class="inline">To:</span>
                <br /> 
                <span class="inline"><input type="text" name="date" id="date-end1" class="text ui-widget-content ui-corner-all"></span>
                <span class="inline"><!--<input type="text" name="time" id="time-end" class="text ui-widget-content ui-corner-all">--></span>
                    <select name="time" id="time-end1" class="text ui-widget-content ui-corner-all">
                    </select>
                <br />
                <input type="hidden" id="viewname1" />
                <input type="hidden"  id="fc-emode1" />               
            </div>
        </div>
        <div id="calendar"></div>

</body>
</html>
